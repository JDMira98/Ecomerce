import{r as i,s as _,t as q,j as e,v as K,N as Q,S as V,B as m,G as W,i as X,z as Y,A as Z,D as ee,E as ae}from"./index-C4RmwaTK.js";import{A as se}from"./Alert-Dizio8qd.js";import{F as re}from"./Form-DKdaOfKv.js";import{C as h}from"./Card-C7lH4Ily.js";import{M as j}from"./Modal-Bauv4i2O.js";import"./Col-CN402Iio.js";function me(){const[A,v]=i.useState(!1),[N,y]=i.useState(!1),[p,u]=i.useState([]),[l,C]=i.useState(null),[F,o]=i.useState(!1),[T,d]=i.useState(""),[M,x]=i.useState("success"),[P,k]=i.useState(""),[b,I]=i.useState("");i.useEffect(()=>{(async()=>{try{const s=await W(0);if(s.products.length>0){const r=s.products.map(c=>{let n;if(typeof c.images=="string")try{n=JSON.parse(c.images)}catch(U){console.error("Error parsing images:",U),n=[]}else n=c.images;return{...c,images:n}});u(r)}}catch(s){console.error("Error fetching products:",s)}})()},[]);const[B,D]=i.useState([]);i.useEffect(()=>{(async()=>{try{const s=await X(0);D(s.categories)}catch(s){console.error("Error fetching categories:",s)}})()},[]);const[t,g]=i.useState({name:"",price:0,images:[""],desc:"",category:"",active:0}),S=()=>{v(!1),y(!1),C(null)},w=(a=null)=>{a?(g(a),C(a),y(!0)):g({name:"",price:0,images:[""],desc:"",category:"",active:0}),v(!0)},E=_(a=>a.user.rol);if(E!==q.ADMIN)return e.jsx(K,{replace:!0,to:"../"});const f=a=>{const{id:s,value:r}=a.target;g(c=>({...c,[s]:r}))},G=a=>{k(a.target.value)},R=a=>{I(a.target.value)},z=(a,s)=>{const r=[...t.images];r[s]=a.target.value,g(c=>({...c,images:r}))},H=()=>{g(a=>({...a,images:[...a.images,""]}))},L=a=>{const s=t.images.filter((r,c)=>c!==a);g(r=>({...r,images:s}))},$=p.filter(a=>{const s=a.name.toLowerCase().includes(P.toLowerCase()),r=b===""||a.category===b;return s&&r}),J=async()=>{try{const a={id:(l==null?void 0:l.id)??0,name:t.name,price:t.price,images:t.images,desc:t.desc,category:t.category,active:1},s={id:(l==null?void 0:l.id)??0,name:t.name,price:t.price,images:JSON.stringify(t.images),desc:t.desc,category:t.category,active:1};N&&l?await Y(s)&&(u(c=>c.map(n=>n.id===l.id?a:n)),d("Producto actualizado correctamente."),x("success")):await Z(s)&&(u(c=>[...c,a]),d("Producto agregado correctamente."),x("success")),o(!0),setTimeout(()=>o(!1),3e3),v(!1)}catch(a){console.error("Error:",a),x("error"),d("Error al guardar el producto."),o(!0),setTimeout(()=>o(!1),3e3)}},O=async a=>{try{a.active===1?(await ee(Number(a.id)),u(s=>s.map(r=>r.id===a.id?{...r,active:0}:r)),d("Producto deshabilitado correctamente.")):(await ae(Number(a.id)),u(s=>s.map(r=>r.id===a.id?{...r,active:1}:r)),d("Producto habilitado correctamente.")),x("success"),o(!0),setTimeout(()=>o(!1),3e3)}catch(s){console.error("Error al cambiar el estado del producto:",s),x("error"),d("Error al cambiar el estado del producto."),o(!0),setTimeout(()=>o(!1),3e3)}};return e.jsxs(e.Fragment,{children:[e.jsx(Q,{}),e.jsxs("div",{className:"d-flex",children:[e.jsx(V,{userRole:E}),e.jsxs("div",{className:"content-container p-4",children:[e.jsx("div",{className:"mb-3",children:e.jsx("input",{type:"text",className:"form-control",placeholder:"Buscar productos",value:P,onChange:G})}),e.jsx("div",{className:"mb-3",children:e.jsxs(re.Select,{onChange:R,value:b,children:[e.jsx("option",{value:"",children:"Filtrar por categoría"}),[...new Set(p.map(a=>a.category))].map(a=>e.jsx("option",{value:a,children:a},a))]})}),e.jsx("div",{className:"d-flex justify-content-start mb-3",children:e.jsxs(m,{variant:"primary",onClick:()=>w(null),className:"d-flex align-items-center",children:[e.jsx("i",{className:"bi bi-plus me-2"}),"Agregar Producto"]})}),p.length===0?e.jsx("h1",{children:"No hay productos disponibles"}):e.jsx("div",{className:"row",children:$.sort((a,s)=>s.active-a.active).map(a=>e.jsx("div",{className:"col-md-4 mb-4",children:e.jsxs(h,{className:"h-100",children:[e.jsx(h.Img,{variant:"top",src:a.images&&a.images.length>0?a.images[0]:void 0,alt:a.name,className:"product-image"}),(!a.images||a.images.length===0)&&e.jsx("div",{className:"no-image-text",children:"No hay imágenes"}),e.jsxs(h.Body,{children:[e.jsx(h.Title,{children:a.name}),e.jsx(h.Text,{style:{marginTop:"20px"},children:a.category}),e.jsxs(h.Text,{children:[e.jsx("strong",{children:"Precio:"})," $",a.price]}),e.jsxs("div",{className:"d-flex",style:{gap:"10px"},children:[e.jsxs(m,{variant:"outline-warning",onClick:()=>w(a),className:"d-flex align-items-center",children:[e.jsx("i",{className:"bi bi-pencil me-2"}),"Editar"]}),e.jsx(m,{variant:a.active===1?"outline-danger":"outline-success",onClick:()=>O(a),className:"d-flex align-items-center",children:a.active===1?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"bi bi-x-circle me-2"}),"Deshabilitar"]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"bi bi-check-circle me-2"}),"Habilitar"]})})]})]})]})},a.id))})]}),F&&e.jsx(se,{message:T,type:M})]}),e.jsxs(j,{show:A,onHide:S,size:"lg","aria-labelledby":"contained-modal-title-vcenter",centered:!0,children:[e.jsx(j.Header,{closeButton:!0,children:e.jsx(j.Title,{children:N?"Editar Producto":"Agregar Producto"})}),e.jsx(j.Body,{children:e.jsxs("form",{children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"name",className:"form-label",children:"Nombre del Producto"}),e.jsx("input",{type:"text",className:"form-control",id:"name",value:t.name,onChange:f})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"price",className:"form-label",children:"Precio"}),e.jsx("input",{type:"number",className:"form-control",id:"price",value:t.price,onChange:f})]}),t.images.length>0?t.images.map((a,s)=>e.jsxs("div",{className:"mb-3",children:[e.jsxs("label",{htmlFor:`image-${s}`,className:"form-label",children:["URL de Imagen ",s+1]}),e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("input",{type:"text",className:"form-control",id:`image-${s}`,value:a,onChange:r=>z(r,s)}),e.jsx(m,{variant:"danger",className:"ms-2",onClick:()=>L(s),children:"Eliminar"})]})]},s)):e.jsx("p",{children:"No hay imágenes. Agrega una imagen."}),e.jsx(m,{variant:"secondary",onClick:H,children:"Agregar otra imagen"}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"desc",className:"form-label",children:"Descripción"}),e.jsx("textarea",{className:"form-control",id:"desc",value:t.desc,onChange:f})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"category",className:"form-label",children:"Categoría"}),e.jsxs("select",{className:"form-control",id:"category",value:t.category,onChange:f,children:[e.jsx("option",{value:"",children:"Selecciona una categoría"}),B.filter(a=>a.active===1).map(a=>e.jsx("option",{value:a.name,children:a.name},a.id))]})]})]})}),e.jsxs(j.Footer,{children:[e.jsx(m,{variant:"secondary",onClick:S,children:"Cerrar"}),e.jsx(m,{variant:"primary",onClick:J,children:N?"Guardar Cambios":"Agregar Producto"})]})]})]})}export{me as default};
