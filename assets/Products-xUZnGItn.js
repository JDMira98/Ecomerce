import{r as o,z as te,o as T,j as e,n as p,A as Ae,D as ke,E as Fe,F as ee,H as Ie,I as Be,J as ae,M as De,K as $e,O as re,Q as Oe,T as Pe,V as He,W as ze,s as Ue,t as Le,v as We,N as _e,S as Ge,B as M,G as Je,X as Ke,Y as Qe,Z as Ve,_ as Xe}from"./index-CfQ2zTCr.js";import{A as Ye}from"./Alert-WiAVoK-0.js";import{C as E}from"./Card-DFxZ1E4B.js";function Ze(){return o.useState(null)}var P;function se(s){if((!P&&P!==0||s)&&te){var t=document.createElement("div");t.style.position="absolute",t.style.top="-9999px",t.style.width="50px",t.style.height="50px",t.style.overflow="scroll",document.body.appendChild(t),P=t.offsetWidth-t.clientWidth,document.body.removeChild(t)}return P}const le=o.forwardRef(({className:s,bsPrefix:t,as:d="div",...u},m)=>(t=T(t,"modal-body"),e.jsx(d,{ref:m,className:p(s,t),...u})));le.displayName="ModalBody";const J=o.forwardRef(({bsPrefix:s,className:t,contentClassName:d,centered:u,size:m,fullscreen:g,children:h,scrollable:S,...A},f)=>{s=T(s,"modal");const v=`${s}-dialog`,x=typeof g=="string"?`${s}-fullscreen-${g}`:`${s}-fullscreen`;return e.jsx("div",{...A,ref:f,className:p(v,t,m&&`${s}-${m}`,u&&`${v}-centered`,S&&`${v}-scrollable`,g&&x),children:e.jsx("div",{className:p(`${s}-content`,d),children:h})})});J.displayName="ModalDialog";const ne=o.forwardRef(({className:s,bsPrefix:t,as:d="div",...u},m)=>(t=T(t,"modal-footer"),e.jsx(d,{ref:m,className:p(s,t),...u})));ne.displayName="ModalFooter";const oe=o.forwardRef(({bsPrefix:s,className:t,closeLabel:d="Close",closeButton:u=!1,...m},g)=>(s=T(s,"modal-header"),e.jsx(Ae,{ref:g,...m,className:p(t,s),closeLabel:d,closeButton:u})));oe.displayName="ModalHeader";const qe=ke("h4"),ie=o.forwardRef(({className:s,bsPrefix:t,as:d=qe,...u},m)=>(t=T(t,"modal-title"),e.jsx(d,{ref:m,className:p(s,t),...u})));ie.displayName="ModalTitle";function ea(s){return e.jsx(re,{...s,timeout:null})}function aa(s){return e.jsx(re,{...s,timeout:null})}const ce=o.forwardRef(({bsPrefix:s,className:t,style:d,dialogClassName:u,contentClassName:m,children:g,dialogAs:h=J,"data-bs-theme":S,"aria-labelledby":A,"aria-describedby":f,"aria-label":v,show:x=!1,animation:b=!0,backdrop:j=!0,keyboard:i=!0,onEscapeKeyDown:N,onShow:B,onHide:w,container:D,autoFocus:C=!0,enforceFocus:H=!0,restoreFocus:z=!0,restoreFocusOptions:U,onEntered:L,onExit:$,onExiting:a,onEnter:r,onEntering:n,onExited:c,backdropClassName:y,manager:O,...de},me)=>{const[ue,ge]=o.useState({}),[he,K]=o.useState(!1),W=o.useRef(!1),_=o.useRef(!1),k=o.useRef(null),[F,fe]=Ze(),xe=Fe(me,fe),Q=ee(w),je=Ie();s=T(s,"modal");const ye=o.useMemo(()=>({onHide:Q}),[Q]);function V(){return O||Oe({isRTL:je})}function X(l){if(!te)return;const R=V().getScrollbarWidth()>0,q=l.scrollHeight>He(l).documentElement.clientHeight;ge({paddingRight:R&&!q?se():void 0,paddingLeft:!R&&q?se():void 0})}const G=ee(()=>{F&&X(F.dialog)});Be(()=>{ae(window,"resize",G),k.current==null||k.current()});const Ne=()=>{W.current=!0},pe=l=>{W.current&&F&&l.target===F.dialog&&(_.current=!0),W.current=!1},Y=()=>{K(!0),k.current=ze(F.dialog,()=>{K(!1)})},ve=l=>{l.target===l.currentTarget&&Y()},be=l=>{if(j==="static"){ve(l);return}if(_.current||l.target!==l.currentTarget){_.current=!1;return}w==null||w()},we=l=>{i?N==null||N(l):(l.preventDefault(),j==="static"&&Y())},Me=(l,R)=>{l&&X(l),r==null||r(l,R)},Se=l=>{k.current==null||k.current(),$==null||$(l)},Ce=(l,R)=>{n==null||n(l,R),Pe(window,"resize",G)},Re=l=>{l&&(l.style.display=""),c==null||c(l),ae(window,"resize",G)},Ee=o.useCallback(l=>e.jsx("div",{...l,className:p(`${s}-backdrop`,y,!b&&"show")}),[b,y,s]),Z={...d,...ue};Z.display="block";const Te=l=>e.jsx("div",{role:"dialog",...l,style:Z,className:p(t,s,he&&`${s}-static`,!b&&"show"),onClick:j?be:void 0,onMouseUp:pe,"data-bs-theme":S,"aria-label":v,"aria-labelledby":A,"aria-describedby":f,children:e.jsx(h,{...de,onMouseDown:Ne,className:u,contentClassName:m,children:g})});return e.jsx(De.Provider,{value:ye,children:e.jsx($e,{show:x,ref:xe,backdrop:j,container:D,keyboard:!0,autoFocus:C,enforceFocus:H,restoreFocus:z,restoreFocusOptions:U,onEscapeKeyDown:we,onShow:B,onHide:w,onEnter:Me,onEntering:Ce,onEntered:L,onExit:Se,onExiting:a,onExited:Re,manager:V(),transition:b?ea:void 0,backdropTransition:b?aa:void 0,renderBackdrop:Ee,renderDialog:Te})})});ce.displayName="Modal";const I=Object.assign(ce,{Body:le,Header:oe,Title:ie,Footer:ne,Dialog:J,TRANSITION_DURATION:300,BACKDROP_TRANSITION_DURATION:150});function la(){const[s,t]=o.useState(!1),[d,u]=o.useState(!1),[m,g]=o.useState([]),[h,S]=o.useState(null),[A,f]=o.useState(!1),[v,x]=o.useState(""),[b,j]=o.useState("success");o.useEffect(()=>{(async()=>{try{const r=await Je(0);if(r.products.length>0){const n=r.products.map(c=>{let y;if(typeof c.images=="string")try{y=JSON.parse(c.images)}catch(O){console.error("Error parsing images:",O),y=[]}else y=c.images;return{...c,images:y}});g(n)}}catch(r){console.error("Error fetching products:",r)}})()},[]);const[i,N]=o.useState({name:"",price:0,images:[""],desc:"",category:"",active:0}),B=()=>{t(!1),u(!1),S(null)},w=(a=null)=>{a?(N(a),S(a),u(!0)):N({name:"",price:0,images:[""],desc:"",category:"",active:0}),t(!0)},D=Ue(a=>a.user.rol);if(D!==Le.ADMIN)return e.jsx(We,{replace:!0,to:"../"});const C=a=>{const{id:r,value:n}=a.target;N(c=>({...c,[r]:n}))},H=(a,r)=>{const n=[...i.images];n[r]=a.target.value,N(c=>({...c,images:n}))},z=()=>{N(a=>({...a,images:[...a.images,""]}))},U=a=>{const r=i.images.filter((n,c)=>c!==a);N(n=>({...n,images:r}))},L=async()=>{try{const a={id:(h==null?void 0:h.id)??0,name:i.name,price:i.price,images:i.images,desc:i.desc,category:i.category,active:1},r={id:(h==null?void 0:h.id)??0,name:i.name,price:i.price,images:JSON.stringify(i.images),desc:i.desc,category:i.category,active:1};d&&h?await Ke(r)&&(g(c=>c.map(y=>y.id===h.id?a:y)),x("Producto actualizado correctamente."),j("success")):await Qe(r)&&(g(c=>[...c,a]),x("Producto agregado correctamente."),j("success")),f(!0),setTimeout(()=>f(!1),3e3),t(!1)}catch(a){console.error("Error:",a),j("error"),x("Error al guardar el producto."),f(!0),setTimeout(()=>f(!1),3e3)}},$=async a=>{try{a.active===1?(await Ve(Number(a.id)),g(r=>r.map(n=>n.id===a.id?{...n,active:0}:n)),x("Producto deshabilitado correctamente.")):(await Xe(Number(a.id)),g(r=>r.map(n=>n.id===a.id?{...n,active:1}:n)),x("Producto habilitado correctamente.")),j("success"),f(!0),setTimeout(()=>f(!1),3e3)}catch(r){console.error("Error al cambiar el estado del producto:",r),j("error"),x("Error al cambiar el estado del producto."),f(!0),setTimeout(()=>f(!1),3e3)}};return e.jsxs(e.Fragment,{children:[e.jsx(_e,{}),e.jsxs("div",{className:"d-flex",children:[e.jsx(Ge,{userRole:D}),e.jsxs("div",{className:"content-container p-4",children:[e.jsx("div",{className:"d-flex justify-content-start mb-3",children:e.jsxs(M,{variant:"primary",onClick:()=>w(null),className:"d-flex align-items-center",children:[e.jsx("i",{className:"bi bi-plus me-2"}),"Agregar Producto"]})}),m.length===0?e.jsx("h1",{children:"No hay productos disponibles"}):e.jsx("div",{className:"row",children:m.sort((a,r)=>r.active-a.active).map(a=>e.jsx("div",{className:"col-md-4 mb-4",children:e.jsxs(E,{className:"h-100",children:[e.jsx(E.Img,{variant:"top",src:a.images&&a.images.length>0?a.images[0]:void 0,alt:a.name,className:"product-image"}),(!a.images||a.images.length===0)&&e.jsx("div",{className:"no-image-text",children:"No hay imágenes"}),e.jsxs(E.Body,{children:[e.jsx(E.Title,{children:a.name}),e.jsx(E.Text,{children:a.category}),e.jsxs(E.Text,{children:[e.jsx("strong",{children:"Precio:"})," $",a.price]}),e.jsxs("div",{className:"d-flex",style:{gap:"10px"},children:[e.jsxs(M,{variant:"outline-warning",onClick:()=>w(a),className:"d-flex align-items-center",children:[e.jsx("i",{className:"bi bi-pencil me-2"}),"Editar"]}),e.jsx(M,{variant:a.active===1?"outline-danger":"outline-success",onClick:()=>$(a),className:"d-flex align-items-center",children:a.active===1?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"bi bi-x-circle me-2"}),"Deshabilitar"]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"bi bi-check-circle me-2"}),"Habilitar"]})})]})]})]})},a.id))})]}),A&&e.jsx(Ye,{message:v,type:b})]}),e.jsxs(I,{show:s,onHide:B,size:"lg","aria-labelledby":"contained-modal-title-vcenter",centered:!0,children:[e.jsx(I.Header,{closeButton:!0,children:e.jsx(I.Title,{children:d?"Editar Producto":"Agregar Producto"})}),e.jsx(I.Body,{children:e.jsxs("form",{children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"name",className:"form-label",children:"Nombre del Producto"}),e.jsx("input",{type:"text",className:"form-control",id:"name",value:i.name,onChange:C})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"price",className:"form-label",children:"Precio"}),e.jsx("input",{type:"number",className:"form-control",id:"price",value:i.price,onChange:C})]}),i.images.length>0?i.images.map((a,r)=>e.jsxs("div",{className:"mb-3",children:[e.jsxs("label",{htmlFor:`image-${r}`,className:"form-label",children:["URL de Imagen ",r+1]}),e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("input",{type:"text",className:"form-control",id:`image-${r}`,value:a,onChange:n=>H(n,r)}),e.jsx(M,{variant:"danger",className:"ms-2",onClick:()=>U(r),children:"Eliminar"})]})]},r)):e.jsx("p",{children:"No hay imágenes. Agrega una imagen."}),e.jsx(M,{variant:"secondary",onClick:z,children:"Agregar otra imagen"}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"desc",className:"form-label",children:"Descripción"}),e.jsx("textarea",{className:"form-control",id:"desc",value:i.desc,onChange:C})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"category",className:"form-label",children:"Categoría"}),e.jsx("input",{type:"text",className:"form-control",id:"category",value:i.category,onChange:C})]})]})}),e.jsxs(I.Footer,{children:[e.jsx(M,{variant:"secondary",onClick:B,children:"Cerrar"}),e.jsx(M,{variant:"primary",onClick:L,children:d?"Guardar Cambios":"Agregar Producto"})]})]})]})}export{la as default};
